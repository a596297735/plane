<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <!-- <meta name="viewport" content="width=device-width, initial-scale=1.0"> -->
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>热狗大战</title>
    <style>
        * {
            margin: 0;
            padding: 0;
        }

        body,
        html {
            overflow: hidden;
            height: 100%;
            background-color: #000;
        }

        li {
            list-style: none;
        }

        #wrap {
            overflow: hidden;
            position: relative;
            left: 30%;
            width: 600px;
            height: 100%;
            background-image: url('./img/bg_1.jpg');
            background-repeat: no-repeat;
            background-size: 100% 100%;
        }

        /* 游戏难度选择 */
        #gameSelect {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 150px;
            color: red;
            text-align: center;
        }

        #gameSelect>ul {
            margin-top: 100px;
        }

        h1 {
            height: 50px;
            padding-bottom: 100px;
            line-height: 50px;
        }

        #gameSelect ul li {
            width: 150px;
            height: 50px;
            margin: 10px 0;
            line-height: 50px;
            font-size: 32px;
            cursor: pointer;
        }

        #gameSelect ul li:hover {
            color: #FFF;
        }

        #logo {
            width: 80px;
            height: 80px;
            margin: 0 auto;
            background-image: url('./img/regou.gif');
            background-size: 100% 100%;
        }

        /* 游戏结束 */
        #gameOver {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 250px;
            height: 300px;
            color: #FFF;
            font-size: 32px;
            line-height: 50px;
            padding-top: 100px;
            text-align: center;

        }

        #score {
            color: #f00;
        }

        /* 游戏开始 */
        #gameStart {
            display: none;
            width: 100%;
            height: 100%;
        }

        /* 我方王思聪 */
        #myplane {
            position: absolute;
            top: 0;
            left: 0;
            z-index: 999;
        }

        .bullet {
            position: absolute;
            top: 0;
            left: 0;
        }

        /* 敌方飞机 */
        .enemy , .boom{
            position: absolute;
            top: 0;
            left: 0;
        }
    </style>
</head>

<body>


    <div id="wrap">
        <!-- 选择难度 -->
        <div id="gameSelect">
            <h1>热狗大战</h1>
            <div id="logo"></div>
            <ul>
                <li>很少热狗</li>
                <li>正常热狗</li>
                <li>好多热狗</li>
                <li>超多热狗</li>
            </ul>
        </div>
        <!-- 开始游戏 -->
        <div id="gameStart">

        </div>
        <!-- 游戏结束 -->
        <div id="gameOver">
            <p>游戏结束！</p>
            您的积分是：<p id="score">100000</p>
        </div>
    </div>



</body>

<script>

    ; (function () {
        [...document.querySelectorAll("#gameSelect li")].forEach(function (item, index) {
            item.addEventListener('click', function (e) {
                // index 表示点击的是哪个难度  
                new Plane(e, index);

            }, false);
        });


        function Plane(e, index) {

            this.init(e, index);
        }

        Plane.prototype = {
            init(e, index) {
                this.wrap = document.getElementById("wrap"),
                this.gameStart = document.getElementById("gameStart"),
                this.gameSelect = document.getElementById("gameSelect"),
                this.gameOver = document.getElementById('gameOver');
                this.myplane = document.getElementById('myplane');
                this.enemyPlanes = document.getElementsByClassName("enemy")[0];
                this.bullet = document.getElementsByClassName("bullet");
                this.fireSpeed = [400, 300, 200, 100][index]; //开火速度
                this.time = [400, 300, 200, 100][index]; //敌机生成速度

                this.showGameBox(); //隐藏选择难度的界面，显示游戏开始界面
                this.createMyPlane(e); // 创建我方王思聪
                this.myPlaneMove(); // 我方王思聪移动
                this.fire(this.fireSpeed); // 开火
                this.createEnemyPlane(this.time);  // 创建敌方飞机并下落
            },
            showGameBox() {
                this.gameSelect.style.display = 'none';
                this.gameStart.style.display = 'block';
            },
            createMyPlane(e) {
                this.myplane = new Image();
                this.myplane.setAttribute('id', 'myplane');
                this.myplane.src = './img/myplane.png';
                this.myplane.width = 60;
                this.myplane.height = 60;
                this.myplane.style.left = e.x - (this.wrap.offsetLeft + this.myplane.width / 2) + 'px';
                this.myplane.style.top = e.y - (this.myplane.height / 2) + 'px';
                this.gameStart.appendChild(this.myplane);
            },
            myPlaneMove() {
                let that = this;
                window.onmousemove = function (e) {
                    that.nowLeft = e.x - (that.wrap.offsetLeft + that.myplane.width / 2);
                    that.nowTop = e.y - (that.myplane.height / 2);
                    that.maxLeft = that.wrap.offsetWidth - that.myplane.width;
                    that.minLeft = 0;
                    that.maxTop = that.wrap.offsetHeight - that.myplane.offsetHeight;
                    that.minTop = 0;

                    if (that.nowLeft < that.minLeft) {
                        that.nowLeft = that.minLeft
                    }
                    if (that.nowLeft > that.maxLeft) {
                        that.nowLeft = that.maxLeft;
                    }
                    if (that.nowTop < that.minTop) {
                        that.nowTop = that.minTop;
                    }
                    if (that.nowTop > that.maxTop) {
                        that.nowTop = that.maxTop;
                    }
                    that.myplane.style.left = that.nowLeft + 'px';
                    that.myplane.style.top = that.nowTop + 'px';
                    // this.isCollision(this.enemyPlanes,this)
                    // this.isCollision(document.getElementsByClassName("enemy"),document.getElementById("myplane"))
                    // console.log()
                }.bind(this)
            },
            fire(speed) {
                setInterval(function () {
                    let bullet = new Image();
                    bullet.className = 'bullet';
                    bullet.src = './img/hotDog.png';
                    bullet.width = 60;
                    bullet.height = 80;
                    bullet.style.top = myplane.offsetTop - myplane.offsetHeight + "px";
                    bullet.style.left = myplane.offsetLeft + "px";
                    gameStart.appendChild(bullet);

                    function move() {
                        let nowTop = bullet.offsetTop;
                        nowTop -= 10;
                        bullet.style.top = nowTop + 'px';
                        // console.log(bullet)
                        // if(this.checkCollision(this.enemyPlanes,bullet)){ //撞上了
                            // console.log("撞上了！！！")
                            // bullet.remove()
                            // cancelAnimationFrame(move.bind(this))
                        // }

                            
                            this.isCollision(document.getElementsByClassName('enemy'),bullet)
                       

                        if (bullet.offsetTop <= -bullet.offsetHeight) {
                            bullet.remove();
                        } else{
                                requestAnimationFrame(move.bind(this));
                            }
                        
                    }
                    move.call(this);
                }.bind(this), this.fireSpeed)
            },
            createEnemyPlane(speed) {

                setInterval(function () {
                    this.enemy = new Image(); //第一架敌方飞机
                    this.enemy.setAttribute('class', 'enemy');
                    this.enemy.src = './img/enemy_small.png';
                    this.enemy.width = 60;
                    this.enemy.height = 60;
                    this.enemy.style.left = this.createRandom(-this.enemy.width / 2, this.wrap.offsetWidth - this.enemy.width / 2) + 'px';//敌机左右最大活动范围
                    this.enemy.style.top = - 100 + 'px';
                    this.gameStart.appendChild(this.enemy);
                    this.speed = this.createRandom(2, 5); // 敌机随机下落速度
                    this.enemyMove(this.enemy, this.speed);
                }.bind(this), this.time);
                
            },
            enemyMove(enemy, speed) {
                let nowTop = enemy.offsetTop;
                nowTop += speed;
                enemy.style.top = nowTop + 'px';
                if (enemy.offsetTop > this.maxTop) {
                    enemy.remove()
                } else {               
                    requestAnimationFrame(this.enemyMove.bind(this, enemy, speed));
                }
            },
            createRandom(min, max) {
                return Math.floor(Math.random() * (max - min + 1) + min);
            },
            isCollision(enemys, bullet) {
                [...enemys].forEach(function (enemy) {
                    var L1 = enemy.offsetLeft,
                        U1 = enemy.offsetTop,
                        R1 = enemy.offsetLeft + enemy.offsetWidth,
                        B1 = enemy.offsetTop + enemy.offsetWidth,

                        L2 = bullet.offsetLeft,
                        U2 = bullet.offsetTop,
                        R2 = bullet.offsetLeft + bullet.offsetWidth,
                        B2 = bullet.offsetTop + bullet.offsetHeight;                                

                    if (R1 >= L2 && B1 >= U2 && L1 <= R2 && U1 <= B2) {
                        enemy.remove();
                        this.boom(enemy);
                    }

                }.bind(this))


            },
            boom(enemy){
                let boom = new Image();
                    boom.src = './img/boom_small.png';
                    boom.className = 'boom';
                    boom.width = 60;
                    boom.height = 60;
                    boom.style.left = enemy.offsetLeft + 'px';
                    boom.style.top = enemy.offsetTop + 'px';
                    // console.log(enemy.offsetLeft)
                    this.gameStart.appendChild(boom);                
            },
            checkCollision(enemys,bullet) {
                // let flag = false;
                [...enemys].forEach(function (item) {
                    if(this.isCollision(item,bullet)){
                        // bullet.remove()
                        console.log(666)
                        // return true;
                    }
                }.bind(this))
            }
        }

    }())

</script>


</html>